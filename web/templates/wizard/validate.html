{% extends "layouts/base.html" %}

{% block title %}Validate | Open OSCAL Wizard{% endblock %}

{% block content %}
  <h1 class="usa-heading">Validate</h1>
  <p class="usa-intro">
    Upload a workspace or SSP JSON file to run validation checks.
  </p>

  {% if errors %}
    <div class="usa-alert usa-alert--error" role="alert" tabindex="-1" id="error-summary">
      <div class="usa-alert__body">
        <h2 class="usa-alert__heading">Please fix the errors below</h2>
        <ul class="usa-list">
          {% for error in errors %}
            <li>{{ error }}</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  {% endif %}

  <form class="usa-form" method="post" action="/validate" enctype="multipart/form-data" novalidate>
    <label class="usa-label" for="json-file">Workspace or SSP JSON</label>
    <div class="usa-hint" id="json-hint">Upload a JSON file.</div>
    <input
      class="usa-file-input"
      id="json-file"
      name="json_file"
      type="file"
      accept=".json,application/json"
      aria-describedby="json-hint"
      required
    >
    <button class="usa-button margin-top-3" type="submit">Run validation</button>
  </form>

  {% if submitted and not errors %}
    <div class="margin-top-4">
      <h2 class="usa-heading--sm">Validation results</h2>
      {% set errors = findings | selectattr('severity', 'equalto', 'error') | list %}
      {% set warnings = findings | selectattr('severity', 'equalto', 'warning') | list %}
      {% set infos = findings | selectattr('severity', 'equalto', 'info') | list %}

      {% if errors %}
        <h3 class="usa-heading--xs">Errors</h3>
        <ul class="usa-list">
          {% for item in errors %}
            <li>{{ item.location }}: {{ item.message }}</li>
          {% endfor %}
        </ul>
      {% endif %}

      {% if warnings %}
        <h3 class="usa-heading--xs">Warnings</h3>
        <ul class="usa-list">
          {% for item in warnings %}
            <li>{{ item.location }}: {{ item.message }}</li>
          {% endfor %}
        </ul>
      {% endif %}

      {% if infos %}
        <h3 class="usa-heading--xs">Info</h3>
        <ul class="usa-list">
          {% for item in infos %}
            <li>{{ item.location }}: {{ item.message }}</li>
          {% endfor %}
        </ul>
      {% endif %}

      {% if not errors and not warnings and not infos %}
        <div class="usa-alert usa-alert--success" role="status">
          <div class="usa-alert__body">
            <p class="usa-alert__text">No validation findings.</p>
          </div>
        </div>
      {% endif %}
    </div>
  {% endif %}
{% endblock %}
