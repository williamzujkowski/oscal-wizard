{% extends "layouts/base.html" %}

{% block title %}Diff Viewer | Open OSCAL Wizard{% endblock %}

{% block content %}
  <h1 class="usa-heading">Diff Viewer</h1>
  <p class="usa-intro">
    Compare two JSON files (workspace or SSP). Narrative fields show inline diffs.
  </p>

  {% if errors %}
    <div class="usa-alert usa-alert--error" role="alert" tabindex="-1" id="error-summary">
      <div class="usa-alert__body">
        <h2 class="usa-alert__heading">Please fix the errors below</h2>
        <ul class="usa-list">
          {% for error in errors %}
            <li>{{ error }}</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  {% endif %}

  <form class="usa-form" method="post" action="/diff" enctype="multipart/form-data" novalidate>
    <label class="usa-label" for="before-file">Before JSON</label>
    <div class="usa-hint" id="before-hint">Upload a JSON file.</div>
    <input
      class="usa-file-input"
      id="before-file"
      name="before_file"
      type="file"
      accept=".json,application/json"
      aria-describedby="before-hint"
      required
    >

    <label class="usa-label" for="after-file">After JSON</label>
    <div class="usa-hint" id="after-hint">Upload a JSON file.</div>
    <input
      class="usa-file-input"
      id="after-file"
      name="after_file"
      type="file"
      accept=".json,application/json"
      aria-describedby="after-hint"
      required
    >

    <button class="usa-button margin-top-3" type="submit">Generate diff</button>
  </form>

  {% if diff_text %}
    <div class="margin-top-4">
      <h2 class="usa-heading">JSON Diff</h2>
      <pre class="usa-prose">{{ diff_text }}</pre>
    </div>
  {% endif %}

  {% if narrative_changes %}
    <div class="margin-top-4">
      <h2 class="usa-heading">Narrative Changes</h2>
      {% for change in narrative_changes %}
        <div class="usa-prose margin-bottom-3">
          <h3 class="usa-heading--sm">{{ change.path }}</h3>
          <div class="usa-prose">{{ change.diff | safe }}</div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endblock %}
